# 鞋子图片智能裁剪工具 v2.1 - 增强功能说明

## 🚀 新增功能概览

### ✨ 主要增强功能

1. **智能画布扩展** - 解决鞋子靠底部/边缘问题
2. **可调节边距控制** - 精确控制鞋子周围留白
3. **白色背景智能填充** - 超出原图部分自动填充

---

## 📋 功能详细说明

### 1. 智能画布扩展 🖼️

**解决的问题：**
- ✅ 鞋子靠近图片底部，裁剪后无法居中显示
- ✅ 鞋子横向过长，接近左右边界，缺少留白空间
- ✅ 受原图边界限制，无法获得理想的裁剪效果

**工作原理：**
- 自动检测是否需要扩展画布
- 创建更大的白色背景画布
- 将原图粘贴到合适位置
- 从扩展画布中裁剪出理想区域

**效果展示：**
```
原图边界限制 → 画布扩展 → 完美居中
┌─────────────┐   ┌───────────────────┐   ┌─────────────┐
│             │   │                   │   │             │
│             │   │   ┌─────────────┐ │   │             │
│    [鞋子]   │→  │   │             │ │ → │   [鞋子]   │
│_____________│   │   │    [鞋子]   │ │   │             │
                  │   │_____________│ │   │             │
                  │                   │   └─────────────┘
                  └───────────────────┘
```

### 2. 可调节边距控制 📏

**边距比例参数：**
- **推荐范围：** 0.10 - 0.25
- **默认值：** 0.15 (相对于对象尺寸的15%)
- **调节效果：**
  - 0.10 = 紧凑布局，边距较小
  - 0.15 = 标准布局，平衡美观
  - 0.25 = 宽松布局，边距较大

**计算方式：**
```
水平边距 = 鞋子宽度 × 边距比例
垂直边距 = 鞋子高度 × 边距比例
目标宽度 = 鞋子宽度 + 2 × 水平边距
目标高度 = 鞋子高度 + 2 × 垂直边距
```

### 3. 白色背景智能填充 🎨

**特点：**
- 使用纯白色 RGB(255, 255, 255) 填充
- 自动检测原图的颜色模式
- 保持透明度处理（如适用）
- 确保与电商平台背景要求一致

---

## 🔧 使用方法

### 命令行模式

```bash
# 使用默认增强设置
python3 shoe_image_processor.py input_images output_images --ratio auto --quality high

# 使用高分辨率模式
python3 shoe_image_processor.py input_images output_images --ratio auto --quality high --hires
```

### GUI模式

1. **启动GUI：**
   ```bash
   python3 shoe_cropper_gui.py
   ```

2. **参数设置：**
   - **边距比例：** 输入 0.10-0.25 之间的数值
   - **智能画布扩展：** 建议保持勾选状态
   - **高分辨率模式：** 适用于大尺寸图片

### 编程接口

```python
from shoe_image_processor import ShoeImageProcessor

processor = ShoeImageProcessor()

# 使用增强版处理
processor.process_single_image(
    input_path="input.jpg",
    output_path="output.jpg",
    target_ratio="auto",
    high_quality=True,
    min_padding_ratio=0.15,      # 边距比例
    enable_canvas_expand=True    # 启用画布扩展
)
```

---

## 📊 处理效果对比

### 测试结果分析

| 参数设置 | 输出尺寸 | 文件大小 | 特点 |
|---------|---------|---------|------|
| 默认设置 (15%边距) | 2688×2016 | 495KB | 标准效果，平衡美观 |
| 大边距 (25%边距) | 3102×2327 | 583KB | 更多留白，适合精品展示 |
| 小边距 (10%边距) | 2481×1861 | 483KB | 紧凑布局，节省空间 |
| 传统模式 | 2688×2016 | 495KB | 受原图边界限制 |

### 处理日志示例

```
✅ 使用了画布扩展技术以获得更好的裁剪效果
📐 扩展画布: 2400×3200 → 2688×3275
📏 扩展边距: 左145px, 上0px, 右143px, 下76px
🎯 对象居中偏差: X=0.2px, Y=61.0px
📊 分辨率保持: 70.6%
```

---

## 🎯 适用场景

### 最适合的图片类型

1. **鞋子位置偏下的商品图**
   - 拍摄时鞋子靠近底部边缘
   - 传统裁剪无法居中显示

2. **横向较长的鞋子图片**
   - 运动鞋、长靴等
   - 接近左右边界，缺少留白

3. **需要标准化的电商图片**
   - 要求统一的4:3或3:4比例
   - 需要一致的边距和居中效果

### 参数推荐

| 应用场景 | 边距比例 | 画布扩展 | 说明 |
|---------|---------|---------|------|
| 电商主图 | 0.15 | ✅ 开启 | 标准商业展示 |
| 精品展示 | 0.20-0.25 | ✅ 开启 | 更多留白，突出产品 |
| 紧凑布局 | 0.10-0.12 | ✅ 开启 | 节省空间，多图展示 |
| 受限环境 | 0.15 | ❌ 关闭 | 仅在原图边界内处理 |

---

## 🔍 技术特点

### 智能检测算法

1. **对象边界检测**
   - 多策略检测：亮度差异、边缘检测、颜色聚类
   - 自适应阈值调整
   - 容错机制和保守策略

2. **居中优化**
   - 视觉中心偏移补偿
   - 精确到像素级的居中控制
   - 实时偏差监测和报告

3. **画布扩展决策**
   - 智能判断是否需要扩展
   - 最小化扩展范围
   - 保持目标比例精确性

### 质量保证

- **分辨率保持：** 最大化保留原图像素
- **格式兼容：** 支持JPG、PNG、WEBP等主流格式
- **文件大小优化：** 智能质量控制，避免文件过大
- **色彩保真：** 保持原图色彩准确性

---

## 📚 更新日志

### v2.1 新增功能

- ✅ 智能画布扩展功能
- ✅ 可调节边距比例控制
- ✅ 白色背景智能填充
- ✅ 增强版GUI界面
- ✅ 详细的处理日志和统计
- ✅ 多参数测试脚本

### v2.0 基础功能

- 智能对象检测
- 多种裁剪比例支持
- 高质量图片保存
- 批量处理能力
- 图形化界面

---

## 💡 使用技巧

1. **边距调节：**
   - 从默认值0.15开始尝试
   - 根据实际效果微调
   - 考虑后续使用场景的空间需求

2. **画布扩展：**
   - 通常建议保持开启
   - 仅在存储空间受限时关闭
   - 可对比处理效果决定

3. **批量处理：**
   - 先用单张图片测试参数
   - 确定最佳设置后批量处理
   - 注意不同尺寸图片的表现差异

4. **质量控制：**
   - 大图优先使用高分辨率模式
   - 电商用途选择高质量保存
   - 注意文件大小与质量的平衡

---

## 🎉 总结

v2.1增强版本完美解决了原有的两个核心问题：

1. **鞋子靠底部** → 通过画布扩展实现完美居中
2. **横向太长接近边界** → 通过边距控制和画布扩展增加留白

新版本在保持原有所有功能的基础上，显著提升了处理效果和用户体验，特别适合电商图片的标准化处理需求。 