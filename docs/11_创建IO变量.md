# 创建IO变量

CMS可以与多种类型控制设备通信进行数据交换，面对现场采用不同协议通信的I/O设备，CMS通过自研的数据采集和实时控制平台，与其建立高效可靠的设备通讯，快速实现多样化设备的数据互联互通。

CMS支持连接的下位设备包括PLC、CNC、传感器、仪表、运动控制器等各种各样的硬件设备，也包括OPC服务器等软件设备。具体底层协议支持范围，详见“设备通信帮助手册”。

本用户手册将以通用的Modbus_TCP协议为例介绍，如果采用其他通讯协议，则配置内容会有所不同，但流程基本一致，此处不作详细介绍，各种各样的I/O设备通信详见“设备通信帮助手册”。

## IO通道连接通讯设备​

在“IO通道”页签下，点击变量通道功能区的添加设备按钮，选择通道对应的通讯协议，输入通道名称，配置通讯参数，点击确认成功创建

#### 基础配置​

#### 高级配置​
    
    
    Modbus_TCP通讯参数  
    通道信息  
    - 通道名称：必填，手动输入通道名称  
    - 通道描述：选填，手动输入通道描述  
      
    基础配置  
    - 设备IP：设备IP，与PLC设置保持一致即可  
    - 设备ID：设备ID，与PLC设置保持一致即可  
    - 端口号：默认为502，可修改，与PLC设置保持一致即可  
    - 首地址：默认为1，可通过下拉选择首地址为0  
    - 超时时间：默认为3秒，可手动修改超时时间  
      
    高级配置  
     字节顺序：  
    - 有符号32位整型：默认为2143，可通过下拉列表选择其它方式  
    - 有符号32位整型：默认为2143，可通过下拉列表选择其它方式  
    - 有符号64位整型：默认为2143，可通过下拉列表选择其它方式  
    - 有符号64位整型：默认为2143，可通过下拉列表选择其它方式  
    - 32位浮点型：默认为2143，可通过下拉列表选择其它方式  
    - 64位浮点型：默认为2143，可通过下拉列表选择其它方式  
    - 字符串：默认为2143，可通过下拉列表选择其它方式  
     其他配置：  
    - 独立链路：默认为禁用，可通过下拉框修改为启用  
    - PDU诊断算法：默认为启用，可通过下拉框修改为禁用  
    - PDU长度：默认为220，可手动修改长度  
    - PDU立即提交：默认禁用，PDU立即提交启用后，驱动程序采集到PDU数据包后，无需等待当前通道同一采集间隔的其他缺省数据，立即提交到redis或第三方平台，响应更快但会损耗一定性能  
    - 静态仿真：默认禁用，静态仿真启用后，系统可在不连接设备的情况下读写外部变量数据。若需要与设备真实通讯，请禁用静态仿真。  
    

## 创建IO通道变量组​

IO通道下可创建分组，便于分类管理变量，下面介绍如何创建变量组

选中对应通道，点击通道节点的添加变量组按钮，在添加变量组弹窗中，输入变量组名称，确认即完成变量组的创建

## 创建IO变量​

在对应变量组中（通道本身也可以作为一个变量组）

创建变量支持手动创建或加载标签两种方式：

手动创建：点击变量列表上方的新增变量按钮，变量列表末尾新增一条变量记录，直接配置以下IO变量属性：

1）变量名：仅能输入中文、字母、数字、下划线、点，且必须以字母或下划线开头，系统全局变量的唯一标识，区分大小写

2）变量描述：辅助理解变量含义，选填

3）变量组：可下拉框调整变量在该通道下所属的变量组

4）数据类型：必填，下拉选择

数据类型（Modbus_TCP协议）  
---  
二进制变量  
有符号8位整型  
无符号8位整型  
有符号16位整型  
无符号16位整型  
有符号32位整型  
无符号32位整型  
有符号64位整型  
无符号64位整型  
F32位浮点数IEEE754  
F64位浮点数IEEE754  
字符串  
      
    
    注：不同协议支持的数据类型略有差异，请参考“设备通信帮助手册”进行定义。  
    

5）变量地址：必填，可直接输入，也可使用地址配置弹窗协助配置地址，遵循协议寄存器地址格式

寄存器名称（Modbus_TCP协议）| 起始地址| 位地址| 数据类型| 说明  
---|---|---|---|---  
线圈状态（读写）| 000001| 无| 二进制| Coil_status  
离散输入状态（只读）| 100001| 无| 二进制| Input_status  
输入寄存器（只读）| 300001| 0-15| 二进制   
有/无符号整型  
浮点型  
字符串型| Input_register  
保持寄存器（读写）| 400001| 0-15| 二进制   
有/无符号整型  
浮点型  
字符串型| Holding_register  
      
    
    注：其他通讯协议设备的可读写寄存器列表，请参考“设备通信帮助手册”  
    

6）读写访问：默认为读写，可下拉框修改为只读或只写

7）采集间隔：默认为100ms，可通过下拉框修改，选项可通过配置按钮修改下拉选项，各通道采集间隔配置独立，单通道采集间隔最多配置3项，最快采集间隔为10ms

8）字符长度：若变量为字符串类型，必填

9）缩放比：展示值和实际值之比，例如变量的实际值为10，缩放比设为10，则显示变量值为100

10）小数位数：设置变量值的精度，选填，不设定（即空），保持原本数值的精度，设定根据下方配置的读写规则保留所设置的精度

11）读写规则：

​ a) 读：缩放比换算后，根据设置的小数位数及读写规则处理

​ 若舍位取数，根据所设置的精确小数位数，将换算值精确位后的舍弃；

​ 若四舍五入，根据所设置的精确小数位数，将换算值精确位后的四舍五入；

​ 若进位取数，根据所设置的精确小数位数，将换算值精确位进位+1；

​ 

​ b) 写：

​ 缩放比换算后，若为整型变量，无论其设置何小数位数，都当整型写入处理，及当作小数位数0处理，后续取数规则同“读规则”示，若为浮点变量，根据设置的小数位数及读写规则处理，规则同“读规则”示

12）历史归档：可选择启用、禁用历史归档功能，可配置历史归档规则，选择当前变量所属的历史归档分组，选填

加载标签：部分协议可通过访问服务器变量列表，用户直接从标签列表添加变量。如OPCUA、S7Comm_Plus、Beckhoff_ADS_Tag、EtherNet/IP_CIP等。

## 变量配置检查​

点击保存并提出优化，可对点表配置进行校验，目前支持优化类型：地址重叠校验、PDU长度校验。

  * 地址重叠校验：不同变量点地址存在重叠部分，若AB两个变量存在地址重叠，当对A变量进行写入操作时，B变量会同时改变；

  * PDU长度校验：部分协议通道配置开放PDU长度，单次读取PDU的最大长度，若变量长度超过PDU长度，会造成读取变量失败。

检查完成，界面提示相关修改项，鼠标悬浮图标可查看对应的报错信息

配置项修改完成或对提示进行忽略操作，可清除优化提示




## 启动变量调试​

点击启动调试，可确认软件和设备的连接是否连通，设备数据采集是否正常，可读写数据、查看质量戳、最新变化时间

  * 当前值：实时更新当前变量值，可输入进行下发；

  * 质量戳：反馈读写操作质量，数据质量码如下：

值| 描述| 处理建议  
---|---|---  
0| 读取/下发成功|   
1| 变量名不存在| 只读取存在的变量名  
2| 数据类型不匹配| 数据类型下发要校验匹配  
3| 变量对应的设备断开| 排查设备断开原因  
4| 其它异常|   
  * 最新变化时间：变量值变化的更新时间；





---

该文档地址来源：https://cms-docs.shengyc.com/cms/tutorial/%E5%8F%98%E9%87%8F%E7%AE%A1%E7%90%86/IO%E9%80%9A%E9%81%93/%E5%88%9B%E5%BB%BAIO%E5%8F%98%E9%87%8F