# 配方应用

在页面中，修改与使用配方管理有两种方式：**配方管理组件** 与**自定义组态配方交互界面**

## 1、配方管理组件​

1.系统提供配方管理组件，位置在组件项-运行中

2.组件功能介绍

## 2、**自定义组态配方交互界面**​

若不想使用系统提供的配方管理组件，可通过事件动作自定义组态配方交互界面，具体步骤：

1、进入页面，以按钮为例，为按钮添加事件动作

2、控制配方执行配方动作。先选择配方控制器作为目标，点击选择动作，将显示支持动作。

动作| 配置项  
---|---  
切换配方集| 可切换到指定配方集或通过传参切换不同配方集  
切换至首个配方| 切换到该配方集第一个配方  
切换至上个配方| 切换到该配方集上一个配方  
切换至下个配方| 切换到该配方集下一个配方  
切换至未个配方| 切换到该配方集最后一个配方  
切换配方| 可切换到指定配方或通过传参切换不同配方  
新增配方| 在当前配方集中增加一个新的配方，参数值为空，位置在当前配方集最后  
修改配方名| 修改当前编辑配方名  
删除配方| 删除当前编辑配方  
保存配方| 保存配方当前参数值  
读取参数变量值| 读配方成分关联变量当前值到配方值  
应用当前编辑配方| /  
创建副本| 以当前编辑配方为模板创建配方，该配方参数配置与当前配方相同，位置在当前配方集最后  
  
3、通过系统关联变量配置需要在运行版显示的信息，如当前配方、配方参数值等信息

### 场景案例​

在咖啡生产线上，有一个配方集，需要生产三种咖啡：咖啡1、咖啡2、咖啡3，配方如下：

通过搭建自定义配方组态界面，现场可以实现**新增配方** 、**修改配方** 、**应用配方** 、**其他相关操作**

#### 1）新增配方​

当现场需要新增一个配方咖啡4

**配置**

为按钮配置事件动作，目标为配方控制器，动作为新增配方

#### 2）修改配方​

当现场需要对咖啡3的参数值与名称进行修改，分为两个步骤：**切换至所需修改的配方** 与**对配方进行修改**

##### i.切换至所需修改的配方​

共有两种切换配方的方式：**切换至指定配方** 与**按配方顺序切换配方**

  * 切换至指定配方

这里提供三种切换至指定配方方式：①通过搜索配方名实现配方切换②通过下拉控制实现配方切换③通过表格实现配方切换

①通过搜索配方名实现配方切换

**配置**

1、为方便观察当前编辑的配方，添加一个数值显示组件，关联变量设为：系统变量-当前编辑配方名称

2、为定位到需要切换的配方，添加中间变量：切换配方

3、添加读写框组件，将读写框关联变量设为”切换配方“

4、添加按钮组件，为按钮配置事件动作，配方名为变量”切换配方“

②通过下拉控制实现配方切换

**配置**

1、添加下拉选择组件，功能选择关联字段，数据集选择：数据管理—配方记录，选择字段为配方名称，此时下拉选择的选项为配方名

2、为下拉选择组件添加动作：切换配方，配方名设为事件参数：event.target.value

③通过表格实现配方切换

**配置**

1、添加表格组件，数据选择：数据管理—配方记录，维度选择：配方名称，此时显示的表格项为配方名

2、为表格组件添加动作：切换配方，配方名设为事件参数：event.cell.value



  * 按配方顺序切换配方

**配置**

添加按钮组件，为按钮添加如下事件动作




##### ii.**对配方进行修改**​

  * 配方参数修改

对配方参数进行修改有两种方式：**手动修改配方参数值** 和**读取参数变量值**

    * 手动修改配方参数值

将咖啡3的”奶“设定值从0改为5

**配置**

​ 1、为编辑配方参数值，添加读写框组件，关联变量设为当前编辑配方参数值

​ 2、添加按钮组件，为按钮添加事件动作：保存配方

​ 

    * 读取参数变量值

当现场需要读取配方3参数的关联变量值

**配置**

为按钮配置事件动作，目标为配方控制器，动作为读取参数变量值




​ 

  * 配方名修改

当现场需要将配方咖啡3的名称改为咖啡n

**配置**

1、在页面中添加按钮，为按钮添加动作：弹窗画面

2、为存储修改的配方名，添加变量：修改的配方名

3、在弹窗画面中添加读写框，将读写框关联变量设为”修改的配方名“

4、在弹窗画面中添加按钮”确认“与”取消“，为“确认”按钮添加动作：返回上一级画面、修改配方名，配方名为变量”修改的配方名“；为”取消“按钮添加动作：关闭页面

5、调整画面配置，确保弹窗画面显示步骤3、4的内容




#### 3）应用配方​

应用配方分为两个步骤：**切换至所需应用的配方** 与**进行应用**

##### i.**切换至所需应用的配方**​

与切换至所需修改的配方操作相同

##### ii.**进行应用**​

当现场需要将应用配方从咖啡1改为咖啡2

**配置**

1、为方便观察当前应用配方，添加一个数值显示组件，关联变量设为：系统变量-当前应用配方

2、添加按钮，为按钮添加动作：应用当前编辑配方

#### 4）其他配方操作​

##### i.删除配方​

当现场需要删除配方3，分为两个步骤：**切换至所需删除的配方** 与**删除配方**

  * ##### **切换至所需删除的配方**​

与切换至所需修改的配方操作相同

  * ##### **删除配方**​

**配置**

为按钮配置事件动作，目标为配方控制器，动作为删除配方




##### ii.创建副本​

当现场需要创建一个与”咖啡2“参数配置相同的配方”咖啡2-1“，分为两个步骤：**切换至所需创建副本的配方** 与**读取参数变量值**

  * **切换至所需创建副本的配方**

与切换至所需修改的配方操作相同

  * **创建副本**

当现场需要创建一个与”咖啡2“参数配置相同的配方”咖啡2-1“

**配置**

为按钮配置事件动作，目标为配方控制器，动作为创建副本




#### 5）注意事项​

i.所有读写框在运行版输入值后回车，实现对指定变量的内容下发。

ii.该场景适用于单配方集，多配方集场景需先切换配方集。


---

该文档地址来源：https://cms-docs.shengyc.com/cms/tutorial/%E9%85%8D%E6%96%B9%E7%AE%A1%E7%90%86/%E9%85%8D%E6%96%B9%E5%BA%94%E7%94%A8