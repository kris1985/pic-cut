name: Build Multi-Platform Executables

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
        
    - name: Build Windows EXE
      run: python build_simple.py
      
    - name: Upload Windows artifacts
      uses: actions/upload-artifact@v4
      with:
        name: windows-exe
        path: |
          dist/*.exe
          dist/ä½¿ç”¨è¯´æ˜.txt
          dist/ç‰ˆæœ¬ä¿¡æ¯.txt
        if-no-files-found: warn

  build-macos:
    runs-on: macos-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
        
    - name: Build macOS App
      run: python build_simple.py
      
    - name: Upload macOS artifacts
      uses: actions/upload-artifact@v4
      with:
        name: macos-app
        path: |
          dist/*.app
          dist/é‹å­å›¾ç‰‡æ™ºèƒ½è£å‰ªå·¥å…·_v2.0_macOS
        if-no-files-found: warn

  build-linux:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
        sudo apt-get update
        sudo apt-get install -y python3-tk xvfb
        
    - name: Build Linux Binary
      run: |
        export DISPLAY=:99
        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &
        python build_simple.py
      
    - name: Upload Linux artifacts
      uses: actions/upload-artifact@v4
      with:
        name: linux-binary
        path: |
          dist/é‹å­å›¾ç‰‡æ™ºèƒ½è£å‰ªå·¥å…·_v2.0_linux
        if-no-files-found: warn

  release:
    needs: [build-windows, build-macos, build-linux]
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && contains(github.ref, 'refs/tags/')
    
    steps:
    - name: Download all artifacts
      uses: actions/download-artifact@v4
      
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          windows-exe/*
          macos-app/*
          linux-binary/*
        body: |
          ## é‹å­å›¾ç‰‡æ™ºèƒ½è£å‰ªå·¥å…· v2.0
          
          ### ğŸ“¦ ä¸‹è½½è¯´æ˜
          - **Windowsç”¨æˆ·**: ä¸‹è½½ `é‹å­å›¾ç‰‡æ™ºèƒ½è£å‰ªå·¥å…·_v2.0_x64.exe`
          - **macOSç”¨æˆ·**: ä¸‹è½½ `.app` æ–‡ä»¶
          - **Linuxç”¨æˆ·**: ä¸‹è½½ `é‹å­å›¾ç‰‡æ™ºèƒ½è£å‰ªå·¥å…·_v2.0_linux`
          
          ### âœ¨ åŠŸèƒ½ç‰¹æ€§
          - ğŸ”¥ æ™ºèƒ½æ–‡ä»¶å¤§å°æ§åˆ¶
          - ğŸ”¥ åŠ¨æ€è´¨é‡è°ƒæ•´
          - ğŸ”¥ å¤šç­–ç•¥å¯¹è±¡æ£€æµ‹
          - ğŸ”¥ é«˜åˆ†è¾¨ç‡æ¨¡å¼ä¼˜åŒ–
          - ğŸ”¥ è‡ªåŠ¨4:3/3:4æ¯”ä¾‹é€‰æ‹©
          
          ### ğŸ–¥ï¸ ç³»ç»Ÿè¦æ±‚
          - **Windows**: Windows 7/8/10/11 (64ä½)
          - **macOS**: macOS 10.14+
          - **Linux**: Ubuntu 18.04+ / CentOS 7+
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 